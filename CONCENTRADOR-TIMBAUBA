#                   version: 6.47.1 (stable)
#          factory-software: 6.42.4
#              total-memory: 256.0MiB
#                       cpu: MIPS 1004Kc V2.15
#                 cpu-count: 4
#           total-hdd-space: 16.0MiB
#         architecture-name: mmips
#                board-name: hEX S
#                  platform: MikroTik
#   installed-version: 6.47.1
# Flags: U - undoable, R - redoable, F - floating-undo
#   ACTION                                   BY               POLICY
# 
# software id = X0I2-WFMQ
#
# model = RB760iGS
# serial number = A8150A9E3A11
/interface bridge
add name=bridge1 protocol-mode=none
add name=bridge65pppoe
add name=loopback protocol-mode=none
/interface ethernet
set [ find default-name=ether1 ] speed=100Mbps
set [ find default-name=ether2 ] speed=100Mbps
set [ find default-name=ether3 ] speed=100Mbps
set [ find default-name=ether4 ] comment="CLIENTE POLYMIX" speed=100Mbps
set [ find default-name=ether5 ] speed=100Mbps
set [ find default-name=sfp1 ] comment="LINK CORE ADTELECOM"
/interface vlan
add interface=sfp1 name="VLAN 65 PPPoE" vlan-id=65
add interface=sfp1 name=VLAN-67-BGP vlan-id=67
add interface=sfp1 name=VLAN-68-POLIMIX vlan-id=68
/interface wireless security-profiles
set [ find default=yes ] supplicant-identity=MikroTik
/ip hotspot profile
set [ find default=yes ] html-directory=flash/hotspot
/ip pool
add name=PPPOe ranges=100.64.98.0/24
add name=dhcp_pool1 ranges=192.168.7.2-192.168.7.254
add name="bloqueados local" ranges=10.255.3.0/24
/ppp profile
add dns-server=208.67.222.222,208.67.220.220 local-address=45.179.229.9 name=PPPoE on-down=":local servername \"<pppoe-\$user>\"\r\n/ipv6 dhcp-server binding remove [find server=\$servername]\r\n:local servername \"<pppoe-\$user>\"\r\n/ipv6 dhcp-server remove [find numbers=\$user]" on-up=":local TOKEN \"811f2b60-f950-454b-843c-689e410f871f\"\r\n:local ipv6pool \"IPv6-PD\"\r\n:local ipnas \"45.171.229.2\"\r\n:local linksgp \"https://sgp.powercomnetwork.com.br\"\r\n:local prefixo\r\n:local servername \"<pppoe-\$user>\"\r\n:delay 15s\r\n:log info [/ipv6 dhcp-server binding find server=\"\$servername\"]\r\n:foreach binding in=[/ipv6 dhcp-server binding find status=\"bound\" server=\"\$servername\"] do={\r\n:set prefixo [/ipv6 dhcp-server binding get \$binding address]\r\n:log info \"FETCH \$linksgp/ws/radius/ipv6/update/\\\?token=\$TOKEN&username=\$user&app=mikrotik&nasip=\$ipnas&pd=\$prefixo\"\r\n/tool fetch url=\"\$linksgp/ws/radius/ipv6/update/\\\?token=\$TOKEN&username=\$user&app=mikrotik&nasip=\$ipnas&pd=\$prefixo\"\r\n}" remote-address=PPPOe
add dns-server=45.171.228.18,8.8.8.8 local-address=45.179.229.9 name="bloqueados " rate-limit=5k/5k remote-address="bloqueados local"
/queue simple
add name=DNS queue=default/default target=45.171.228.19/32,45.171.228.18/32,1.1.1.1/32,8.8.8.8/32,8.8.4.4/32
/routing ospf instance
set [ find default=yes ] redistribute-connected=as-type-1 redistribute-static=as-type-1 router-id=45.171.229.9
/snmp community
set [ find default=yes ] disabled=yes
add addresses="45.171.228.51/32,172.16.200.40/32,172.16.200.41/32,172.16.200.42/32,172.16.200.43/32,10.125.50.0/24" name=POWERCOM
/user group
set full policy="local,telnet,ssh,ftp,reboot,read,write,policy,test,winbox,password,web,sniff,sensitive,api,romon,dude,tikapp"
/interface bridge port
add bridge=bridge1 interface=ether4
add bridge=bridge1 interface=VLAN-68-POLIMIX
add bridge=bridge65pppoe interface=ether1
add bridge=bridge65pppoe interface="VLAN 65 PPPoE"
add bridge=bridge65pppoe interface=ether2
add bridge=bridge65pppoe interface=ether3
add bridge=bridge65pppoe interface=ether5
/ip neighbor discovery-settings
set discover-interface-list=all
/interface pppoe-server server
# Service is on a slave interface
add default-profile=PPPoE disabled=no interface=ether1 max-mru=1500 max-mtu=1500 mrru=1600 one-session-per-host=yes service-name=service1
# Service is on a slave interface
add default-profile=PPPoE disabled=no interface=ether2 max-mru=1500 max-mtu=1500 mrru=1600 service-name=service2
# Service is on a slave interface
add default-profile=PPPoE disabled=no interface=ether3 max-mru=1500 max-mtu=1500 mrru=1600 service-name=service3
# Service is on a slave interface
add default-profile=PPPoE disabled=no interface=ether4 max-mru=1500 max-mtu=1500 mrru=1600 service-name=service4
# Service is on a slave interface
add default-profile=PPPoE disabled=no interface=ether5 max-mru=1500 max-mtu=1500 mrru=1600 service-name=service5
/ip address
add address=172.30.5.2/30 interface=VLAN-67-BGP network=172.30.5.0
add address=45.171.229.9 interface=loopback network=45.171.229.9
add address=192.168.7.1/24 interface=ether4 network=192.168.7.0
add address=10.10.130.1/30 interface=ether1 network=10.10.130.0
/ip dhcp-client
add comment=defconf disabled=no
/ip dns
set servers=45.171.228.18,8.8.8.8
/ip firewall address-list
add address=177.52.37.142 list=IP-SGP
add address=149.18.73.14 list=BLOQUEADOS
add address=149.18.73.14 list=BLOQUEIO
add address=45.171.228.0/22 list=PERMITIDOS
add address=172.16.200.0/26 list=PERMITIDOS
add address=8.8.8.8 list=DNS
add address=8.8.4.4 list=DNS
add address=1.1.1.1 list=DNS
add address=208.67.220.220 list=DNS
add address=208.67.222.222 list=DNS
add address=45.171.228.18 list=DNS
add address=45.171.228.19 list=DNS
add address=51.222.156.94 list=DNS
add address=135.148.32.77 list=DNS
add address=45.171.228.1 list=EQUIPAMENTOS
add address=45.171.228.0 list=EQUIPAMENTOS
add address=45.171.229.2 list=EQUIPAMENTOS
add address=45.171.229.3 list=EQUIPAMENTOS
add address=45.171.229.4 list=EQUIPAMENTOS
add address=45.171.229.5 list=EQUIPAMENTOS
add address=45.171.229.6 list=EQUIPAMENTOS
add address=45.171.229.7 list=EQUIPAMENTOS
add address=45.171.229.8 list=EQUIPAMENTOS
add address=45.171.229.9 list=EQUIPAMENTOS
add address=45.171.229.10 list=EQUIPAMENTOS
add address=118.194.251.58 list=BLOQUEIO
add address=167.94.146.59 list=BLOQUEIO
add address=198.235.24.49 list=BLOQUEIO
add address=23.90.160.146 list=BLOQUEIO
add address=198.235.24.162 list=BLOQUEIO
add address=162.142.125.220 list=BLOQUEIO
add address=170.106.115.253 list=BLOQUEIO
add address=115.84.91.39 list=BLOQUEIO
add address=167.248.133.45 list=BLOQUEIO
add address=205.210.31.30 list=BLOQUEIO
add address=103.203.59.7 list=BLOQUEIO
add address=167.94.145.59 list=BLOQUEIO
add address=162.142.125.210 list=BLOQUEIO
add address=167.248.133.119 list=BLOQUEIO
add address=103.123.1.216 list=BLOQUEIO
add address=87.236.176.53 list=BLOQUEIO
add address=94.102.61.29 list=BLOQUEIO
add address=177.52.37.142 list=PERMITIDOS
add address=85.121.205.159 list=BLOQUEIO
add address=188.169.129.236 list=BLOQUEIO
add address=103.189.249.229 list=BLOQUEIO
add address=37.210.88.22 list=BLOQUEIO
add address=201.144.11.166 list=BLOQUEIO
add address=212.56.203.142 list=BLOQUEIO
add address=100.64.0.0/10 list=PERMITIDOS
add address=192.168.0.0/16 list=PERMITIDOS
add address=172.16.0.0/12 list=PERMITIDOS
add address=10.0.0.0/8 list=PERMITIDOS
add address=10.125.50.0/24 list=PERMITIDOS
/ip firewall filter
add action=accept chain=input comment=SGP src-address=177.52.37.142
add action=accept chain=input src-address-list=PERMITIDOS
add action=drop chain=forward src-address=10.255.4.0/24
add action=drop chain=forward src-address=10.255.3.0/24
add action=drop chain=input dst-port=0-1024 protocol=tcp src-address-list=!PERMITIDOS
add action=drop chain=input dst-port=0-1024 protocol=udp src-address-list=!PERMITIDOS
add action=drop chain=input disabled=yes log=yes src-address-list=!PERMITIDOS
/ip firewall nat
add action=accept chain=srcnat dst-address=45.171.231.13 dst-port=1812-1813,3799 protocol=udp
add action=src-nat chain=srcnat protocol=!ospf src-address=100.64.98.0/24 to-addresses=45.171.229.9
/ip firewall raw
add action=drop chain=prerouting src-address-list=BLOQUEADOS
/ip route
add distance=1 gateway=172.30.5.1
add distance=1 dst-address=100.64.98.0/24 type=blackhole
/ip service
set telnet disabled=yes
set ftp disabled=yes
set www disabled=yes
set ssh port=2222
set api disabled=yes
set api-ssl disabled=yes
/ppp aaa
set use-radius=yes
/ppp secret
add name=pw password=01 profile=PPPoE service=pppoe
add comment="dia 08/08" disabled=yes name=leoterio password=998291353 service=pppoe
add comment="dia 08/08" disabled=yes name=anderson password=996176435 service=pppoe
add comment="dia 10/08" disabled=yes name=alex password=9986338737 service=pppoe
add comment="dia 10/08" disabled=yes name=sinesio password=996517555 service=pppoe
add comment="dia 10/08" disabled=yes name=silvioherique password=991085530 service=pppoe
add comment="dia 14/08" disabled=yes name=arlindosilva password=996639600 service=pppoe
add comment="dia 17/08" disabled=yes name=maylanches@timbauba password=8499079523 service=pppoe
add comment="dia 17/08" disabled=yes name=roberta@timbauba password=84996201908 service=pppoe
add name=Cinho/ password=11223344 service=pppoe
add disabled=yes name=silvio@timbauba password=11223344 service=pppoe
add disabled=yes name=sinesio@timbauba password=11223344 service=pppoe
add name=tatiane@matb profile="bloqueados " service=pppoe
/radius
add accounting-port=3513 address=177.52.37.142 authentication-port=3512 comment="RADIUS SGP - POWERCOM (CLOUD)" secret=123@mudar service=ppp src-address=45.171.229.9 timeout=3s
add address=45.171.228.54 comment="RADIUS SGP" secret=123@mudar service=ppp src-address=45.171.229.9 timeout=3s
add address=45.178.101.35 comment=SGP disabled=yes secret=123@mudar service=ppp src-address=45.171.229.9 timeout=3s
add address=45.171.228.52 comment=GEOGE disabled=yes secret=123456 service=ppp src-address=45.171.229.9 timeout=3s
/radius incoming
set accept=yes
/routing filter
add action=discard chain=ospf-out prefix=100.64.98.0/24 prefix-length=32
add action=discard chain=ospf-out prefix=10.255.3.0/24
/routing ospf interface
add interface=VLAN-67-BGP network-type=point-to-point
/routing ospf network
add area=backbone network=172.30.5.0/30
add area=backbone network=45.171.229.9/32
/snmp
set enabled=yes trap-community=POWERCOM trap-version=2
/system clock
set time-zone-autodetect=no time-zone-name=America/Recife
/system identity
set name=POWERCOM_TIBAUBA
/system ntp client
set enabled=yes primary-ntp=45.171.228.20 server-dns-names=45.171.228.19,45.171.228.18
/system scheduler
add interval=1d name=FTP on-event=FTP policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-date=feb/22/2022 start-time=22:38:38
/system script
add dont-require-permissions=no name=FTP owner=pwcomadmin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source=":log warning \"***************************************\"\r\n# Conex\E3o FTP\r\n:global host 10.125.50.14\r\n:global usuario powercom\r\n:global senha gJ3hcIxpWQQ4wp5\r\n:global diretorio /CONCENTRADOR/RB-TIMBAUBA\r\n# Pega o nome do Router\r\n:global identifica [/system identity get name ];\r\n# Gera data no formato AAAA-MM-DD\r\n:global data [/system clock get date]\r\n:global meses (\"jan\",\"feb\",\"mar\",\"apr\",\"may\",\"jun\",\"jul\",\"aug\",\"sep\",\"oct\",\"nov\",\"dec\");\r\n:global ano ([:pick \$data 7 11])\r\n:global mestxt ([:pick \$data 0 3])\r\n:global mm ([ :find \$meses \$mestxt -1 ] + 1);\r\n:if (\$mm < 10) do={ :set mm (\"0\" . \$mm); }\r\n:global mes ([:pick \$ds 7 11] . \$mm . [:pick \$ds 4 6])\r\n:global dia ([:pick \$data 4 6])\r\n:log info \"Gerando backup: \$ano-\$mes-\$dia.\$identifica.backup\";\r\n/system backup save name=\"\$ano-\$mes-\$dia.\$identifica\";\r\n:log info \"Gerando export: \$ano-\$mes-\$dia.\$identifica.rsc\";\r\n/export file=\"\$ano-\$mes-\$dia.\$identifica\"\r\n:log info \"Processando...\";\r\n:delay 5s\r\n:log info \"Conectando FTP Server...\";\r\n:log info \"Enviando Backup [\$ano-\$mes-\$dia.\$identifica.backup] ...\";\r\n/tool fetch address=\$host src-path=\"\$ano-\$mes-\$dia.\$identifica.backup\" user=\"\$usuario\" password=\"\$senha\" port=21 upload=yes mode=ftp dst-path=\"\$diretorio/\$ano-\$mes-\$dia.\$identifica.backup\"\r\n:log info \"Enviando Export [\$ano-\$mes-\$dia.\$identifica.rsc] ...\";\r\n/tool fetch address=\$host src-path=\"\$ano-\$mes-\$dia.\$identifica.rsc\" user=\"\$usuario\" password=\"\$senha\" port=21 upload=yes mode=ftp dst-path=\"\$diretorio/\$ano-\$mes-\$dia.\$identifica.rsc\"\r\n:delay 1\r\n:log info \"Backup enviado com sucesso...\";\r\n:log info \"Removendo arquivos...\";\r\n /file remove \"\$ano-\$mes-\$dia.\$identifica.backup\"\r\n /file remove \"\$ano-\$mes-\$dia.\$identifica.rsc\"\r\n:log info \"Rotina de backup finalizada...\";\r\n:log warning \"***************************************\";\r\n"
/tool romon
set enabled=yes secrets=123@powercom
